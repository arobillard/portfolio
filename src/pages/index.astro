---
import { getCollection } from 'astro:content';
import { objectSorter } from '../scripts/helpers';
import CaseStudyPreview from '../components/CaseStudyPreview/CaseStudyPreview.astro';
import Hero from '../components/Hero/Hero.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
import QuickLinks from '../components/QuickLinks/QuickLinks.astro';

const allCaseStudies = await getCollection('case-studies').then((data) =>
  data.sort((a, b) => objectSorter(a.data.order, b.data.order))
);

const allCSCats = await getCollection('cool-stuff-categories').then((data) =>
  data.sort((a, b) => objectSorter(a.data.order, b.data.order))
);

const coolStuffQuickLinks: object[] = [];

allCSCats.forEach((cat) => {
  coolStuffQuickLinks.push({
    title: cat.data.title,
    text: cat.data.description,
    link: `/cool-stuff#${cat.id}`,
    label: `Check them out`,
  });
});

// allCaseStudies.sort((a, b) => objectSorter(a.data.order, b.data.order));
---

<BaseLayout>
  <Hero link={`#${allCaseStudies[0].slug}`} />

  {
    allCaseStudies.map((cs, index) => (
      <CaseStudyPreview cs={cs} index={index} count={allCaseStudies.length} />
    ))
  }

  <QuickLinks title="Some Other Cool Stuff" items={coolStuffQuickLinks} />
</BaseLayout>
